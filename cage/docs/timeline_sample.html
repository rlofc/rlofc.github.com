

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>samples / timeline.c &mdash; Cage  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/breathe.css" type="text/css" />
  

  
    <link rel="top" title="Cage  documentation" href="index.html"/>
        <link rel="next" title="samples / callout.c" href="callout_sample.html"/>
        <link rel="prev" title="samples / sprite.c" href="sprite_sample.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Cage
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="game.html">Game essentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="image.html">image</a></li>
<li class="toctree-l1"><a class="reference internal" href="font.html">font</a></li>
<li class="toctree-l1"><a class="reference internal" href="sprite.html">sprite</a></li>
<li class="toctree-l1"><a class="reference internal" href="animate.html">animation</a></li>
<li class="toctree-l1"><a class="reference internal" href="timeline.html">timeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="sound.html">sound</a></li>
<li class="toctree-l1"><a class="reference internal" href="keyboard.html">keyboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="mouse.html">mouse</a></li>
<li class="toctree-l1"><a class="reference internal" href="screen.html">screen</a></li>
<li class="toctree-l1"><a class="reference internal" href="color.html">color</a></li>
<li class="toctree-l1"><a class="reference internal" href="state_sample.html">samples / state.c</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_sample.html">samples / image.c</a></li>
<li class="toctree-l1"><a class="reference internal" href="sprite_sample.html">samples / sprite.c</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">samples / timeline.c</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-sample-data-struct">The sample data struct</a></li>
<li class="toctree-l2"><a class="reference internal" href="#timeline-event-callbacks">Timeline event callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create">Create</a></li>
<li class="toctree-l2"><a class="reference internal" href="#update">Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="#destroy">Destroy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main">Main</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="callout_sample.html">samples / callout.c</a></li>
<li class="toctree-l1"><a class="reference internal" href="collisions_sample.html">samples / collisions.c</a></li>
<li class="toctree-l1"><a class="reference internal" href="chipmunk_sample.html">samples / chipmunk.c</a></li>
<li class="toctree-l1"><a class="reference internal" href="wizard.html">samples / wizard.c</a></li>
<li class="toctree-l1"><a class="reference internal" href="tiled.html">samples / tiled.c</a></li>
<li class="toctree-l1"><a class="reference internal" href="android.html">CAGE on Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">(More) Advanced</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Cage</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>samples / timeline.c</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="samples-timeline-c">
<h1>samples / timeline.c<a class="headerlink" href="#samples-timeline-c" title="Permalink to this headline">¶</a></h1>
<p>In this example we will learn how to use the timeline.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#include &quot;cage.h&quot;</span>
</pre></div>
</div>
<div class="section" id="the-sample-data-struct">
<h2>The sample data struct<a class="headerlink" href="#the-sample-data-struct" title="Permalink to this headline">¶</a></h2>
<p>We use a struct to hold the sample resources:
a timeline and a font.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">struct</span> <span class="n">sample_data</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">timeline</span><span class="o">*</span> <span class="n">timeline</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">font</span><span class="o">*</span> <span class="n">font</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="timeline-event-callbacks">
<h2>Timeline event callbacks<a class="headerlink" href="#timeline-event-callbacks" title="Permalink to this headline">¶</a></h2>
<p>The following functions are timeline event callbacks. These
functions will be called by the timeline based on its registered
events.
Each function gets call on every frame update during its duration.
The <strong>data</strong> argument will hold any data you pass to <strong>update_timeline</strong>.
The <strong>progress</strong> argument will range from 0 to 1 based on the event
duration.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span><span class="o">*</span> <span class="nf">fade_in</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">float</span> <span class="n">elapsed_ms</span><span class="p">,</span> <span class="kt">float</span> <span class="n">progress</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">sample_data</span><span class="o">*</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
    <span class="n">screen_color</span><span class="p">(</span>
    <span class="n">color_from_RGB</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">progress</span><span class="p">));</span>
    <span class="n">UNUSED</span><span class="p">(</span><span class="n">elapsed_ms</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span><span class="o">*</span> <span class="nf">caption_1</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">float</span> <span class="n">elapsed_ms</span><span class="p">,</span> <span class="kt">float</span> <span class="n">progress</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">sample_data</span><span class="o">*</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
    <span class="n">draw_text</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">font</span><span class="p">,</span> <span class="s">&quot;Once upon a time,&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="n">UNUSED</span><span class="p">(</span><span class="n">elapsed_ms</span><span class="p">);</span>
    <span class="n">UNUSED</span><span class="p">(</span><span class="n">progress</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span><span class="o">*</span> <span class="nf">caption_2</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">float</span> <span class="n">elapsed_ms</span><span class="p">,</span> <span class="kt">float</span> <span class="n">progress</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">sample_data</span><span class="o">*</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
    <span class="n">draw_text</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">font</span><span class="p">,</span> <span class="s">&quot;in a land far, far away...&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="n">UNUSED</span><span class="p">(</span><span class="n">elapsed_ms</span><span class="p">);</span>
    <span class="n">UNUSED</span><span class="p">(</span><span class="n">progress</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span><span class="o">*</span> <span class="nf">quit</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">float</span> <span class="n">elapsed_ms</span><span class="p">,</span> <span class="kt">float</span> <span class="n">progress</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">UNUSED</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
    <span class="n">UNUSED</span><span class="p">(</span><span class="n">elapsed_ms</span><span class="p">);</span>
    <span class="n">UNUSED</span><span class="p">(</span><span class="n">progress</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="create">
<h2>Create<a class="headerlink" href="#create" title="Permalink to this headline">¶</a></h2>
<p>We use the game state create() function to create the sample data
struct instance that holds the timeline and a font.
Once we have a new timeline, we use append_event() to add events.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span><span class="o">*</span> <span class="nf">create_sample</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">sample_data</span><span class="o">*</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sample_data</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sd</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>

    <span class="n">sd</span><span class="o">-&gt;</span><span class="n">timeline</span> <span class="o">=</span> <span class="n">create_timeline</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">timeline</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">append_event</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">timeline</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">fade_in</span><span class="p">);</span>
        <span class="n">append_event</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">timeline</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">caption_1</span><span class="p">);</span>
        <span class="n">append_event</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">timeline</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">caption_2</span><span class="p">);</span>
        <span class="n">append_event</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">timeline</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">quit</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span>
        <span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>

    <span class="n">sd</span><span class="o">-&gt;</span><span class="n">font</span> <span class="o">=</span> <span class="n">create_font</span><span class="p">(</span><span class="s">&quot;res/font.png&quot;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">font</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">sd</span><span class="p">;</span>

<span class="nl">cleanup</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sd</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">destroy_timeline</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">timeline</span><span class="p">);</span>
        <span class="n">destroy_font</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">font</span><span class="p">);</span>
    <span class="p">}</span>

<span class="nl">error</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="update">
<h2>Update<a class="headerlink" href="#update" title="Permalink to this headline">¶</a></h2>
<p>For each frame, the update state function will update the timeline,
resulting event callbacks invocation.
The data and elapsed_ms arguments we pass along will eventually end
up getting to the timeline callbacks.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">update_sample</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">float</span> <span class="n">elapsed_ms</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">sample_data</span><span class="o">*</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
    <span class="n">update_timeline</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">timeline</span><span class="p">,</span> <span class="n">sd</span><span class="p">,</span> <span class="n">elapsed_ms</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="destroy">
<h2>Destroy<a class="headerlink" href="#destroy" title="Permalink to this headline">¶</a></h2>
<p>In the destroy() function we destroy the timeline,
destroy the font and free the memory we allocated for
the sample data struct.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">destroy_sample</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">sample_data</span><span class="o">*</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
    <span class="n">destroy_timeline</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">timeline</span><span class="p">);</span>
    <span class="n">destroy_font</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">font</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="main">
<h2>Main<a class="headerlink" href="#main" title="Permalink to this headline">¶</a></h2>
<p>Finally, the game&#8217;s main function delegates the
execution to Cage&#8217;s game_loop() function together with
the 3 state functions we wrote.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">game_loop</span><span class="p">(</span><span class="n">create_sample</span><span class="p">,</span> <span class="n">update_sample</span><span class="p">,</span> <span class="n">destroy_sample</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="callout_sample.html" class="btn btn-neutral float-right" title="samples / callout.c" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sprite_sample.html" class="btn btn-neutral" title="samples / sprite.c" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2016, Ithai Levi (RLofC@).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>